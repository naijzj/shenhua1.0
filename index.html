<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥è¯Â·å¤©å‘½</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="cultivation-styles.css">
</head>
<body>
    <div class="game-container">
        <header class="game-header">
            <h1 class="game-title">ç¥è¯Â·å¤©å‘½</h1>
            <div class="player-info">
                <div class="player-name" id="player-name">æ— åä¿®å£«</div>
                <div class="player-rank" id="player-rank">ç»ƒæ°”æœŸ 1å±‚</div>
            </div>
        </header>
        
        <main class="game-content">
            <section class="game-navigation">
                <button class="nav-button" id="cultivation-btn">ä¿®ç‚¼</button>
                <button class="nav-button" id="inventory-btn">èƒŒåŒ…</button>
                <button class="nav-button" id="shop-btn">å®ç‰©é˜</button>
                <button class="nav-button" id="sect-btn">å®—é—¨</button>
                <button class="nav-button" id="mission-btn">ä»»åŠ¡</button>
                <button class="nav-button" id="karma-btn">å› æœ</button>
            </section>
            
            <section class="game-main-view">
                <div class="welcome-message">
                    <h2>è¸å…¥ä»™é€”ï¼Œé€é¹¿å¤©å‘½</h2>
                    <p>æ¬¢è¿æ¥åˆ°ä¿®çœŸä¸–ç•Œï¼Œåœ¨è¿™é‡Œä½ å°†è¸ä¸Šæ¼«æ¼«ä¿®ç‚¼è·¯ï¼Œè¿½å¯»é•¿ç”Ÿä¹…è§†ã€é—®é¼å¤§é“çš„ç»ˆæç›®æ ‡ã€‚</p>
                    <p>ç‚¹å‡»å·¦ä¾§èœå•å¼€å§‹ä½ çš„ä¿®ä»™ä¹‹æ—…ï¼</p>
                </div>
            </section>
        </main>
        
        <footer class="game-footer">
            <div class="resources">
                <div class="resource-item">
                    <span class="resource-icon">ğŸ’</span>
                    <span class="resource-value" id="currency-display">1000</span>
                    <span class="resource-label">çµçŸ³</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">âœ¨</span>
                    <span class="resource-value" id="cultivation-display">0</span>
                    <span class="resource-label">ä¿®ä¸º</span>
                </div>
                <div class="resource-item">
                    <span class="resource-icon">â˜¯ï¸</span>
                    <span class="resource-value" id="karma-display">0</span>
                    <span class="resource-label">å› æœ</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- è¿™é‡Œå°†åŠ è½½æ¸¸æˆæ¨¡å— -->
    <script type="module">
        import PlayerModule from './player.js';
        import CultivationModule from './cultivation.js';
        import cultivationUI from './cultivation-ui.js';
        import KarmaManager from './karma-manager.js';
        import KarmaUI from './karma-ui.js';
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            updateDisplays();
            
            // æ·»åŠ æŒ‰é’®äº‹ä»¶
            document.getElementById('cultivation-btn').addEventListener('click', () => {
                cultivationUI.showUI();
            });
            
            document.getElementById('inventory-btn').addEventListener('click', () => {
                window.location.href = 'inventory.html';
            });
            
            document.getElementById('shop-btn').addEventListener('click', () => {
                window.location.href = 'shop.html';
            });
            
            document.getElementById('sect-btn').addEventListener('click', () => {
                alert('å®—é—¨åŠŸèƒ½å³å°†å¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…ï¼');
            });
            
            document.getElementById('mission-btn').addEventListener('click', () => {
                alert('ä»»åŠ¡ç³»ç»Ÿå³å°†å¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…ï¼');
            });
            
            document.getElementById('karma-btn').addEventListener('click', () => {
                // è·³è½¬åˆ°å› æœè¯¦æƒ…é¡µ
                window.location.href = 'karma-details.html';
            });
            
            // ç›‘å¬ç©å®¶æ•°æ®å˜åŒ–
            PlayerModule.addObserver('currency', (value) => {
                document.getElementById('currency-display').textContent = value;
            });
            
            PlayerModule.addObserver('cultivation', (data) => {
                // ç¡®ä¿dataå’Œdata.valueæ˜¯åˆæ³•çš„
                const cultivationValue = data && typeof data === 'object' ? data.value : data;
                document.getElementById('cultivation-display').textContent = typeof cultivationValue === 'number' ? Math.floor(cultivationValue) : '0';
                
                // æ›´æ–°å¢ƒç•Œå’Œå±‚çº§
                const cultivationDetails = CultivationModule.getCultivationDetails();
                const rank = data && data.rank ? data.rank : PlayerModule.playerData.cultivationRank;
                document.getElementById('player-rank').textContent = `${rank} ${cultivationDetails.level}å±‚`;
            });
            
            // ç›‘å¬å› æœå€¼å˜åŒ–
            KarmaManager.onKarmaChange((newValue) => {
                document.getElementById('karma-display').textContent = Math.floor(newValue);
            });
            
            // æµ‹è¯•ç”¨ - æ·»åŠ å› æœå€¼æŒ‰é’®
            const testPanel = document.createElement('div');
            testPanel.className = 'test-panel';
            testPanel.innerHTML = `
                <div style="position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px;">
                    <button id="add-karma">å¢åŠ å› æœå€¼(+50)</button>
                    <button id="reduce-karma">å‡å°‘å› æœå€¼(-30)</button>
                </div>
            `;
            document.body.appendChild(testPanel);
            
            document.getElementById('add-karma').addEventListener('click', () => {
                KarmaManager.updateKarma(50);
            });
            
            document.getElementById('reduce-karma').addEventListener('click', () => {
                KarmaManager.updateKarma(-30);
            });
        });
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplays() {
            document.getElementById('currency-display').textContent = PlayerModule.getCurrency();
            
            // è·å–ä¿®ä¸ºå€¼å¹¶ç¡®ä¿å®ƒæ˜¯ä¸€ä¸ªæ•°å­—
            let cultivationDisplay = document.getElementById('cultivation-display');
            let cultivation = PlayerModule.getCultivation();
            
            // ç›´æ¥æ˜¾ç¤ºä¿®ä¸ºæ•°å€¼ï¼Œä¸å¸¦ä»»ä½•æ ¼å¼
            cultivationDisplay.textContent = typeof cultivation === 'number' ? Math.floor(cultivation) : '0';
            
            // ç¡®ä¿å› æœå€¼æ˜¯ä¸€ä¸ªæ•°å­—
            document.getElementById('karma-display').textContent = Math.floor(KarmaManager.getKarma());
            
            // è·å–ç©å®¶åç§°å’Œå¢ƒç•Œ
            document.getElementById('player-name').textContent = PlayerModule.playerData.name;
            const cultivationDetails = CultivationModule.getCultivationDetails();
            document.getElementById('player-rank').textContent = `${PlayerModule.playerData.cultivationRank} ${cultivationDetails.level}å±‚`;
        }
    </script>
</body>
</html> 